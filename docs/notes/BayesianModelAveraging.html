<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Alexander Fisher">

<title>STA360 - Bayesian model averaging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STA360</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">schedule</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html">syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notes/exam-notes.html">distributions</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapterSummaries.html">notes</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../links.html">links</a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#model-averaging-setup" id="toc-model-averaging-setup" class="nav-link" data-scroll-target="#model-averaging-setup">Model averaging setup</a></li>
  <li><a href="#complete-bayesian-model" id="toc-complete-bayesian-model" class="nav-link" data-scroll-target="#complete-bayesian-model">Complete Bayesian model</a></li>
  <li><a href="#example-diabetes" id="toc-example-diabetes" class="nav-link" data-scroll-target="#example-diabetes">Example: Diabetes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bayesian model averaging</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Alexander Fisher </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>Consider the standard regression problem,</p>
<p><span class="math display">\[
Y | \beta, \sigma^2 \sim N_n(X\beta, \sigma^2 I_n)
\]</span></p>
<p>where each term is of typical dimension,</p>
<ul>
<li><span class="math inline">\(Y \in \mathbb{R}^n\)</span> vector of observations,</li>
<li><span class="math inline">\(X \in \mathbb{R}^{n \times p}\)</span> matrix of predictors,</li>
<li><span class="math inline">\(\beta \in \mathbb{R}^p\)</span> vector of coefficients,</li>
<li><span class="math inline">\(\sigma^2 \in \mathbb{R}\)</span>, and</li>
<li><span class="math inline">\(I_n \in \mathbb{R}^{n \times n}\)</span>.</li>
</ul>
<p>Often, when we have many covariates, i.e.&nbsp;<span class="math inline">\(p\)</span> is large, we believe that some do not really explain <span class="math inline">\(Y\)</span>. A particular subset of the explanatory variables is termed a <strong>model</strong> of <span class="math inline">\(Y\)</span>. Since each explanatory variable belongs in the model, or does not, there are <span class="math inline">\(K = 2^p\)</span> total models we can consider.</p>
<p>For notational convenience, let <span class="math inline">\(M_1, \ldots, M_{K}\)</span> be the models under study.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>For even modestly large <span class="math inline">\(p\)</span>, such as <span class="math inline">\(p=64\)</span> in the example below, there are more possible models <span class="math inline">\(2^{64} \approx 1.8 \times 10^{19}\)</span> than there are grains of sand on earth (about <span class="math inline">\(7.5 \times 10^{18}\)</span>).</p>
<p>For this reason, we will never be able to sample a substantial proportion of all the models.</p>
</div>
</div>
<p>There are many different questions one might answer with a regression model. Sometimes, the model itself is of interest i.e.&nbsp;we wish to select a single model <span class="math inline">\(M_j\)</span>. Other times, we may care about estimating a particular coefficient <span class="math inline">\(\beta_i\)</span> to understand how a single predictor relates to <span class="math inline">\(Y\)</span>. Alternatively, we may really care about making predictions for new data.</p>
<p>These tasks are not mutually exclusive, but might direct our approach differently.</p>
<p>In particular, if we are interested in prediction, or estimating a particular coefficient, then it’s important to realize that estimates such as <span class="math inline">\(\hat{\beta}\)</span> or a function thereof, <span class="math inline">\(\hat{Y} = X \hat{\beta}\)</span> are implicitly conditioned on a specific model.</p>
<ul>
<li>How can we address uncertainty in the model itself?</li>
</ul>
</section>
<section id="model-averaging-setup" class="level2">
<h2 class="anchored" data-anchor-id="model-averaging-setup">Model averaging setup</h2>
<p>Let <span class="math inline">\(z \in \mathbb{R}^p\)</span> be a vector of indicator variables <span class="math inline">\(z_1, \ldots, z_p\)</span>, where <span class="math inline">\(z_j = 1\)</span> means the <span class="math inline">\(j\)</span>th predictor is in the model, and <span class="math inline">\(z_j = 0\)</span> means it is not. Conceptually, <span class="math inline">\(z\)</span> tells us which regression coefficients are non-zero.</p>
<p><span class="math display">\[
y_i = z_1 \beta_1 x_{i, 1} + \ldots + z_p \beta_p x_{i,p} + \epsilon
\]</span></p>
<p>where <span class="math inline">\(\epsilon \sim N(0, \sigma^2)\)</span>.</p>
<p>In matrix form,</p>
<p><span class="math display">\[
Y|\beta, z, \sigma^2 \sim N_n(XZ\beta, \sigma^2 I_n)
\]</span></p>
<p>where <span class="math inline">\(Z = z I_p\)</span> is a diagonal matrix.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each separate “model” <span class="math inline">\(M\)</span> is equivalent to a different vector <span class="math inline">\(z\)</span>.</p>
</div>
</div>
<p>Once we’ve setup our likelihood to explicitly condition on the model, <span class="math inline">\(z\)</span>, we continue our usual Bayesian practice: we make inferences about <em>all</em> unknowns: <span class="math inline">\(\beta, \sigma^2\)</span>, and <span class="math inline">\(z\)</span>.</p>
<p>Now, however we can differentiate between estimates of <span class="math inline">\(\beta\)</span> conditional on a model,</p>
<p><span class="math display">\[
E[\beta | y, z] = \int \beta p(\beta | y, z) d\beta
\]</span></p>
<p>versus estimates of <span class="math inline">\(\beta\)</span> that account for model uncertainty:</p>
<p><span class="math display">\[
\begin{aligned}
E[\beta | y] = \sum_{z} \int \beta p(\beta, z | y) d\beta
\end{aligned}
\]</span></p>
</section>
<section id="complete-bayesian-model" class="level2">
<h2 class="anchored" data-anchor-id="complete-bayesian-model">Complete Bayesian model</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Model</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Gibbs updates</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Data generative model:</p>
<p><span class="math display">\[
Y|\beta, z, \sigma^2 \sim N_n(X_z\beta_z, \sigma^2 I_n)
\]</span></p>
<p>Common prior specification:</p>
<p><span class="math display">\[
\begin{aligned}
\beta_z | \sigma^2 &amp;\sim N_z \left(0, g \sigma^2 (X_z^TX_z)^{-1}\right)\\
1/\sigma^2 &amp;\sim \text{gamma}(\frac{\nu_0}{2}, \frac{\nu_0}{2} \sigma_0^2)\\
p(z_i = 1) &amp;= \frac{1}{2} \text{ for all i}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(g\)</span> is some fixed constant and <span class="math inline">\(\beta_z\)</span> is the set of <span class="math inline">\(\beta\)</span> corresponding to non-zero entries of <span class="math inline">\(z\)</span> (<span class="math inline">\(X_z\)</span> is constructed similarly). The prior on <span class="math inline">\(\beta\)</span> is known as Zellner’s <span class="math inline">\(g\)</span> prior <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The <span class="math inline">\(g\)</span> prior is mathematically convenient and leads to nice marginal distributions for our Gibbs sampler.</p>
<p>Where does the prior variance of <span class="math inline">\(\beta\)</span> come from? Recall: <span class="math inline">\(Var[\hat{\beta}_{OLS}] = \sigma^2 (X^TX)^{-1}\)</span>. So a priori we expect the variance of <span class="math inline">\(\beta\)</span> to look like the OLS variance and <span class="math inline">\(g\)</span> controls the weight of this prior variance (or <span class="math inline">\(1/g\)</span> controls the weight of the precision). Small <span class="math inline">\(g\)</span> implies more prior precision relative to the data.</p>
<ul>
<li>Question: what should <span class="math inline">\(g\)</span> be equal to for unit precision?</li>
</ul>
<!-- The precision then, for $n$ observations is $(X^TX) / \sigma^2$. Unit precision would be $\frac{1}{n} \cdot (X^TX) / \sigma^2$.  -->
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<section id="beta" class="level3">
<h3 class="anchored" data-anchor-id="beta">Beta</h3>
<p><span class="math display">\[
\beta_z | X_z, \sigma^2, y \sim N_z\left( A^{-1}b,
A^{-1}
\right)
\]</span></p>
<p>where <span class="math inline">\(A^{-1} = \sigma^2 \left( \frac{g}{g+1}\right)(X_z^TX_z)^{-1}\)</span> and <span class="math inline">\(b = \frac{1}{\sigma^2} X_z^Ty\)</span>.</p>
<p>We can simplify the full conditional notation,</p>
<p><span class="math display">\[
\beta_z | X_z, \sigma^2, y \sim N_z\left(
\left(\frac{g}{g+1}\right)\hat{\beta}_{z(OLS)},~
\left(\frac{g}{g+1}\right)  \sigma^2 \left[X_z^TX_z\right]^{-1}
\right)
\]</span></p>
</section>
<section id="sigma-squared" class="level3">
<h3 class="anchored" data-anchor-id="sigma-squared">sigma-squared</h3>
<p>We can integrate out <span class="math inline">\(\beta\)</span> analytically, for a more efficient sampler,</p>
<p><span class="math display">\[
1/\sigma^2 | X_z, y \sim \text{gamma}([\nu_0 + n]/2, [\nu_0 \sigma_0^2 + SSR_g^z]/2)
\]</span></p>
<p>where <span class="math inline">\(SSR_g^z = y^T(I - \frac{g}{g+1} X_z (X_z^T X_z)^{-1} X_z^T)y\)</span></p>
</section>
<section id="z" class="level3">
<h3 class="anchored" data-anchor-id="z">z</h3>
<p><span class="math display">\[
z_j \sim \text{binary}(o_j/(1 + o_j))
\]</span></p>
<p>where <span class="math inline">\(p_j\)</span> is the probability that <span class="math inline">\(z_j = 1\)</span>, and is given by</p>
<p><span class="math display">\[
o_j = \frac
{Pr(z_j = 1 | y, X, z_{-j})}
{Pr(z_j = 0 | y, X, z_{-j})}
= \frac{p(y|X, z_{-j}, z_j = 1) p(z_j = 1)}
{p(y|X, z_{-j}, z_j = 0) p(z_j = 0)}
\]</span></p>
<p>See page 165 of the book for details on how to compute the marginal likelihood <span class="math inline">\(p(y|X, z)\)</span>.</p>
</section>
</div>
</div>
</div>
</section>
<section id="example-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="example-diabetes">Example: Diabetes</h2>
<p>This example comes from Hoff Ch 9.</p>
<p>The data below contains our outcome variable, diabetes progression (first column) and 64 predictors. This example and data set appeared on a previous homework.</p>
<div class="cell">
<details>
<summary>load libraries</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>data load and setup</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>yX.diabetes.train<span class="ot">&lt;-</span><span class="fu">dget</span>(<span class="fu">url</span>(<span class="st">"https://sta360-fa24.github.io/data/yX.diabetes.train"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> yX.diabetes.train[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> yX.diabetes.train[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>useful functions</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log-probability of y given x</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>lpyx <span class="ot">=</span> <span class="cf">function</span>(y, X, <span class="at">g=</span><span class="fu">length</span>(y), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">nu0=</span><span class="dv">1</span>, <span class="at">s20 =</span> <span class="fu">try</span>(<span class="fu">summary</span>(<span class="fu">lm</span>(y<span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>X))<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>, <span class="at">silent =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span><span class="fu">nrow</span>(X)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">ncol</span>(X)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    Hg <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    s20 <span class="ot">=</span><span class="fu">mean</span>(y<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    Hg <span class="ot">=</span> (g <span class="sc">/</span> (g <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">*</span> X <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  SSRg <span class="ot">=</span> <span class="fu">t</span>(y) <span class="sc">%*%</span> (<span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow =</span> n) <span class="sc">-</span> Hg) <span class="sc">%*%</span>y</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>.<span class="dv">5</span> <span class="sc">*</span>(n <span class="sc">*</span><span class="fu">log</span>(pi) <span class="sc">+</span> p <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> g) <span class="sc">+</span> (nu0 <span class="sc">+</span> n) <span class="sc">*</span> <span class="fu">log</span>(nu0 <span class="sc">*</span>s20 <span class="sc">+</span> SSRg)<span class="sc">-</span> nu0 <span class="sc">*</span><span class="fu">log</span>(nu0 <span class="sc">*</span>s20)) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lgamma</span>((nu0 <span class="sc">+</span> n) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> <span class="fu">lgamma</span>(nu0 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">=</span> <span class="cf">function</span>(y, X, <span class="at">g =</span> <span class="fu">length</span>(y)) {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span><span class="fu">nrow</span>(X)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">ncol</span>(X)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  Hg <span class="ot">=</span> (g<span class="sc">/</span>(g<span class="sc">+</span><span class="dv">1</span>)) <span class="sc">*</span> X <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">t</span>(y) <span class="sc">%*%</span> (<span class="fu">diag</span>(<span class="dv">1</span>,<span class="at">nrow=</span>n) <span class="sc">-</span> Hg) <span class="sc">%*%</span> y)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>getVarianceBeta <span class="ot">=</span> <span class="cf">function</span>(X, s2, <span class="at">g =</span> <span class="fu">length</span>(y)) {</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  (g <span class="sc">/</span> (g<span class="sc">+</span><span class="dv">1</span>)) <span class="sc">*</span> s2 <span class="sc">*</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>getOLS_mean <span class="ot">=</span> <span class="cf">function</span>(y, X, varBeta, <span class="at">g =</span> <span class="fu">length</span>(y)) {</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  varBeta <span class="sc">%*%</span>  <span class="fu">t</span>(X) <span class="sc">%*%</span> y</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>MCMC</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">200</span> <span class="co"># num iterations</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed quantities</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>nu0 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>sigma02 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>alpha_n <span class="ot">=</span> (nu0 <span class="sc">+</span> n)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>beta_const <span class="ot">=</span> nu0 <span class="sc">*</span> sigma02</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">length</span>(y)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># objects to fill</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, S, p)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>BETA <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, S, p)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>SIGMA2 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, S, <span class="dv">1</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="do">## starting values ##</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(X))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>lpy.c <span class="ot">=</span> <span class="fu">lpyx</span>(y , X[,z<span class="sc">==</span><span class="dv">1</span>, <span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Gibbs sampler</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S) {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update z</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(X))) {</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    zp <span class="ot">=</span> z</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    zp[j] <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> zp[j]</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    lpy.p <span class="ot">=</span> <span class="fu">lpyx</span>(y, X[,zp<span class="sc">==</span><span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">=</span> (lpy.p <span class="sc">-</span> lpy.c) <span class="sc">*</span> (<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span>(zp[j]<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    z[j] <span class="ot">=</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>r)))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(z[j] <span class="sc">==</span> zp[j]) {</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      lpy.c <span class="ot">=</span> lpy.p</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  Z[s,] <span class="ot">=</span> z</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## update sigma^2</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, alpha_n, (beta_const <span class="sc">+</span> </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">SSR</span>(y, X[,z<span class="sc">==</span><span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>]))<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  SIGMA2[s] <span class="ot">=</span> s2</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## update beta</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  varBeta <span class="ot">=</span> <span class="fu">getVarianceBeta</span>(X[,z<span class="sc">==</span><span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>], s2)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  meanBeta <span class="ot">=</span> <span class="fu">getOLS_mean</span>(y, X[,z<span class="sc">==</span><span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>], varBeta <span class="sc">/</span> s2)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> meanBeta,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sigma =</span> varBeta)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  BETA[s,z<span class="sc">==</span><span class="dv">1</span>] <span class="ot">=</span> beta</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Probability of regressors</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Diagnostics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Posterior summaries</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output-display">
<p><img src="BayesianModelAveraging_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<section id="trace-plots" class="level3">
<h3 class="anchored" data-anchor-id="trace-plots">trace plots</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">sigma2 =</span> SIGMA2[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>S)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> sigma2)) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"iteration"</span>, <span class="at">y =</span> <span class="fu">TeX</span>(r<span class="st">'($\sigma^2$)'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BayesianModelAveraging_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">beta2 =</span> BETA[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="dv">1</span>, <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>S)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> beta2)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"iteration"</span>, <span class="at">y =</span> <span class="fu">TeX</span>(r<span class="st">'($</span><span class="sc">\b</span><span class="st">eta_2$)'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BayesianModelAveraging_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="effective-size" class="level3">
<h3 class="anchored" data-anchor-id="effective-size">effective size</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Z, <span class="dv">2</span>, effectiveSize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       V1        V2        V3        V4        V5        V6        V7        V8 
200.00000 122.61862   0.00000 103.73609  46.31771  27.11704  36.39864 103.84635 
       V9       V10       V11       V12       V13       V14       V15       V16 
200.00000 200.00000 200.00000 131.97829 200.00000 200.00000 200.00000 105.30279 
      V17       V18       V19       V20       V21       V22       V23       V24 
200.00000 109.46251 200.00000 125.03977 200.00000 133.38260 141.21845 200.00000 
      V25       V26       V27       V28       V29       V30       V31       V32 
200.00000 200.00000  87.26784 156.01952 200.00000 200.00000 200.00000 200.00000 
      V33       V34       V35       V36       V37       V38       V39       V40 
200.00000 200.00000 200.00000 157.92121 200.00000 200.00000 200.00000 159.02378 
      V41       V42       V43       V44       V45       V46       V47       V48 
200.00000 154.07992  86.32241 200.00000 200.00000 200.00000 200.00000 124.12176 
      V49       V50       V51       V52       V53       V54       V55       V56 
200.00000 200.00000 200.00000 200.00000  98.08846 200.00000 200.00000 112.44715 
      V57       V58       V59       V60       V61       V62       V63       V64 
147.64897 200.00000 200.00000 200.00000 200.00000 117.52886 200.00000 200.00000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(SIGMA2, <span class="dv">2</span>, effectiveSize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> V1 
200 </code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">

</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>yX.diabetes.test<span class="ot">&lt;-</span><span class="fu">dget</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">url</span>(<span class="st">"https://sta360-fa24.github.io/data/yX.diabetes.test"</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Xtest <span class="ot">=</span> yX.diabetes.test[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ytest <span class="ot">=</span> yX.diabetes.test[,<span class="dv">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>betaHat <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">colSums</span>(BETA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> S)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>yHat <span class="ot">=</span> Xtest <span class="sc">%*%</span> betaHat</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(yHat, ytest) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yHat, <span class="at">y =</span> ytest)) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">TeX</span>(r<span class="st">'($\hat{y}$)'</span>), <span class="at">y =</span> <span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="BayesianModelAveraging_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The predictive sum of squared error is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((yHat <span class="sc">-</span> ytest)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45.2647</code></pre>
</div>
</div>
<p>Compare this to the predictive sum of squared error from ridge regression on the homework.</p>
</div>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Zellner, Arnold. “On assessing prior distributions and Bayesian regression analysis with g-prior distributions.” Bayesian inference and decision techniques (1986).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>